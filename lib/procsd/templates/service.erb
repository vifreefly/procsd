[Unit]
Requires=network.target
PartOf=<%= config["target_name"] %>
<% if config["command"]["restart"] -%>
ReloadPropagatedFrom=<%= config["target_name"] %>
<% end -%>

[Service]
Type=simple
User=<%= config["user"] %>
WorkingDirectory=<%= config["dir"] %>

ExecStart=/bin/bash -lc '<%= config["command"]["start"] %>'
<% if stop = config["command"]["stop"] -%>
ExecStop=/bin/bash -lc '<%= stop %>'
<% end -%>
<% if config["command"]["restart"] -%>
ExecReload=/bin/bash -lc '<%= config["command"]["restart"] %>'
<% end -%>

Restart=always
RestartSec=1
TimeoutStopSec=15
KillMode=mixed
StandardInput=null
SyslogIdentifier=<%= config["id"] %>

Environment="PATH=<%= config["path"] %>"
<% config["environment"].each do |key, value| -%>
Environment="<%= key %>=<%= value %>"
<% end -%>
